<!-- header.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>CrowdFunding</h1>
            <nav>
                <ul>
                    <li><a href="/create_campaign"><i class="fas fa-plus"></i>Create Campaign</a></li>
                    <li><a href="#"><i class="fas fa-list"></i>View Transactions</a></li>
                    <li><a href="#" id="connectWalletBtn"><i class="fas fa-wallet"></i>Connect Wallet</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div id="walletModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <iframe src="templates\index.html" width="100%" height="100%"></iframe>
        </div>
    </div>

    <script>
        document.getElementById('connectWalletBtn').addEventListener('click', function() {
            document.getElementById('walletModal').style.display = 'block';
        });

        // Close the modal when clicking outside of it
        window.onclick = function(event) {
            var modal = document.getElementById('walletModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

</body>
</html> -->

<!-- header.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link rel="stylesheet" href="static\styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>CrowdFunding</h1>
            <nav>
                <ul>
                    <li><a href="/create_campaign"><i class="fas fa-plus"></i>Create Campaign</a></li>
                    <li><a href="#" id="connectWalletBtn"><i class="fas fa-wallet"></i>Connect Wallet</a></li>
                    <li><a href="#"><i class="fas fa-list"></i>View Transactions</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div id="walletModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <center>
                <h1>Connect Your MetaMask Wallet Here!</h1>
                <p id="walletAddress"></p>
                <p id="walletBalance"></p>
                <button id='getBalance' onclick="checkBalance()">Get Balance of Wallet</button>
            </center>
        </div>
    </div>

    <script>
        document.getElementById('connectWalletBtn').addEventListener('click', function() {
            document.getElementById('walletModal').style.display = 'block';
            checkInstalled();
        });

        document.getElementsByClassName('close')[0].addEventListener('click', function() {
            document.getElementById('walletModal').style.display = 'none';
        });

        async function checkInstalled() {
            if (typeof window.ethereum == 'undefined') {
                document.getElementById('walletModal').innerHTML = "<center>MetaMask isn't installed, please install it.</center>";
                return false;
            }
            connectWalletwithMetaMask();
        }

        async function connectWalletwithMetaMask() {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' })
                .catch((e) => {
                    console.error(e.message)
                    return
                })

            if (!accounts) { return }

            window.userWalletAddress = accounts[0]
            document.getElementById('walletAddress').innerText = "Connected Wallet Address: " + window.userWalletAddress

            setTimeout(() => {
                checkBalance();
            }, 2000);

            setTimeout(() => {
                signOutOfMetaMask();
            }, 10000);
        }

        async function signOutOfMetaMask() {
            window.userWalletAddress = null
            document.getElementById('walletAddress').innerText = 'Wallet Disconnected'

            setTimeout(() => {
                connectWalletwithMetaMask();
            }, 3000);
        }

        async function checkBalance() {
            let balance = await window.ethereum.request({
                method: "eth_getBalance",
                params: [
                    window.userWalletAddress,
                    'latest'
                ]
            }).catch((err) => {
                console.log(err)
            })

            document.getElementById('walletBalance').innerText = "Wallet Balance: " + parseFloat((balance) / Math.pow(10, 18)) + " ETH";
        }
    </script>
</body>
</html>
